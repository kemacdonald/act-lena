---
title: "Lena-pred Data Visualization"
output: html_document
---

## Set up

```{r libraries and config}
source(here::here("code/00_config/lena-pred-libraries.R"))
source(here::here("code/00_config/lena-pred-pitch-config.R"))
source(here("code/00_helper_functions/plot_helpers.R"))
source(here("code/00_helper_functions/lstm-helpers.R"))
```

Read model predictions 

```{r}
data_path <- paste0("data/03_summaries/", dataset_config$data_set)
d_list <- read_rds(here(data_path, "lena-pred-lstm-preds.rds"))
```

## ManyBabies

```{r}
d <- extract_preds(d_list) %>% mutate(duration_ms = as.numeric(duration_ms)) 
```

### ADS vs. CDS average predictability

First, we replicate the key analysis in Rasanen et al. (2018), which compared the average predictability of ADS vs. CDS.

```{r}
seg_ms <- d %>% 
  filter(is_target_cluster == TRUE) %>% 
  group_by(seg_id, speech_register, n_qshapes, speaker_id, duration_ms) %>% 
  summarise(m_prob = mean(prob_mass),
            m_acc = mean(correct_pred))
```

```{r}
plot_model_output(seg_ms, col_name = m_prob)
```

### Accuracy predicting next cluster

```{r}
plot_model_output(seg_ms, col_name = m_acc)
```

### Predictability as a function of utterance length

Here, we replicate Rasanen et al. (2018)'s analysis of how the predictability of the intonation changes as a function of position in the utterances, and whether the differences in IDS and ADS would be specific to certain position(s).

Plot the F0 predictability measures as a function of duration of the utterance for both speech registers.

```{r}
seg_ms %>% 
  ggplot(aes(x = duration_ms / 1000, y = m_prob, color = speech_register)) +
  geom_point(alpha = 0.4, size = 2) +
  geom_smooth(method = "lm", size = 1.5) +
  scale_color_ptol() +
  lims(y=c(0, 1.01)) +
  labs(x = "Utterance Duration (sec)", y = "Mean Prob. of Correct Prediction")
```

### Predictability as a function of within-utterance position

```{r}
n_bins <- 10
n_shapes <- 16

d_within_utt <- d %>% 
  filter(is_target_cluster == TRUE, n_qshapes == n_shapes, duration_ms <= 7000) %>% 
  mutate(time_bin_id_num = as.numeric(time_bin_id)) %>% 
  group_by(seg_id) %>% 
  mutate(time_bin_within_utt = cut_interval(time_bin_id_num, n = n_bins, labels = F))

ss_within_utt <- d_within_utt %>% 
  group_by(seg_id, speaker_id, time_bin_within_utt, speech_register) %>% 
  summarise(m_prob = mean(prob_mass), m_acc = mean(correct_pred))

ms_within_utt <- ss_within_utt %>% 
  group_by(time_bin_within_utt, speech_register) %>% 
  tidyboot_mean(column = m_prob) 

ms_within_utt %>% 
  ggplot(aes(x = as_factor(time_bin_within_utt), y = empirical_stat, 
             color = speech_register, group = speech_register)) +
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper)) +
  geom_line(size = 1) +
  scale_color_ptol() +
  lims(y = c(0, NA)) +
  labs(x = "Relative position in Utterance", y = "Mean Prob. Correct Prediction") +
  theme(legend.position = "top")
```


## IDSLabel

Below we use the same code with minor modifications to visualize the IDSLabel dataset.

### ADS vs. CDS average predictability

### Accuracy predicting next cluster

### Predictability as a function of utterance length