---
title: "Lena-pred Visualization"
author: "Kyle MacDonald"
output: html_document
---

## Set up

```{r libraries and config}
source(here::here("code/00_config/lena-pred-libraries.R"))
source(here("code/00_config/lena-pred-pitch-config.R"))
source(here("code/00_config/plot_theme.R"))
```

Read model predictions 

```{r}
data_path <- paste0("data/03_summaries/", dataset_config$data_set)
d <- read_fst(here(data_path, "lena-pred-lstm-preds.fst"))
```

```{r}
bin_length <- 100 # ms
d %>% mutate(duration_nbins = as.numeric(duration_nbins),
             duration_ms = duration_nbins * bin_length) -> d
```


## ManyBabies

### ADS vs. CDS average predictability

First, we replicate the key analysis in Rasanen et al. (2018), which compared the average predictability of ADS vs. CDS.

```{r}
seg_ms <- d %>% 
  filter(is_target_cluster == TRUE) %>% 
  group_by(seg_id, speech_register, duration_ms) %>% 
  summarise(m_prob = mean(prob_mass),
            m_acc = mean(correct_pred))
```

Plot

```{r}
seg_ms %>% 
  group_by(speech_register) %>% 
  tidyboot_mean(column = m_prob, nboot = 100) %>% 
  ggplot(aes(x = speech_register, y = empirical_stat)) +
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper)) +
  lims(y=c(0, 0.4)) +
  labs(x = "Speech Register", y = "Mean Prob Mass")
```

### Accuracy predicting next cluster

```{r}
seg_ms %>% 
  group_by(speech_register) %>% 
  tidyboot_mean(column = m_acc, nboot = 100) %>% 
  ggplot(aes(x = speech_register, y = empirical_stat)) +
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper)) +
  lims(y=c(0, 0.6)) +
  labs(x = "Speech Register", y = "Mean Accuracy")
```

### Predictability as a function of utterance length

Here, we replicate Rasanen et al. (2018)'s analysis of how the predictability of the intonation changes as a function of position in the utterances, and whether the differences in IDS and ADS would be specific to certain position(s).

Plot the F0 predictability measures as a function of duration of the utterance for both speech registers.

```{r}
seg_ms %>% 
  ggplot(aes(x = duration_ms / 1000, y = m_prob, color = speech_register)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_ptol() +
  lims(y=c(0, 0.5)) +
  labs(x = "Utternce Duration (sec)", y = "Mean Prob. of Correct Prediction")
```

## IDSLabel

Below we use the same code with minor modifications to visualize the IDSLabel dataset.

### ADS vs. CDS average predictability

### Accuracy predicting next cluster

### Predictability as a function of utterance length